(self.webpackChunkslack_react_ts=self.webpackChunkslack_react_ts||[]).push([[890],{862:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>_e});var a=n(7753);const l=(0,a.Z)("button",{target:"elthdtx0"})("background:transparent;border:none;width:26px;height:26px;display:inline-flex;justify-content:center;align-items:center;color:white;margin-left:10px;cursor:pointer;",(({collapse:e})=>e&&"\n    & i {\n      transform: none;\n    }\n  "),";");var r=n(3564),o=n(7294),s=n(5977),i=n(3727),c=n(8118);const d=({channel:e})=>{const{workspace:t}=(0,s.UO)(),n=(0,s.TH)(),{data:a}=(0,c.ZP)("/api/users",r.Z,{dedupingInterval:2e3}),l=localStorage.getItem(`${t}-${e.name}`)||0,{data:d,mutate:p}=(0,c.ZP)(a?`/api/workspaces/${t}/channels/${e.name}/unreads?after=${l}`:null,r.Z);return(0,o.useEffect)((()=>{n.pathname===`/workspace/${t}/channel/${e.name}`&&p(0)}),[p,n.pathname,t,e]),o.createElement(i.OL,{key:e.name,activeClassName:"selected",to:`/workspace/${t}/channel/${e.name}`},o.createElement("span",{className:void 0!==d&&d>0?"bold":void 0},"# ",e.name),void 0!==d&&d>0&&o.createElement("span",{className:"count"},d))},p=()=>{const{workspace:e}=(0,s.UO)(),[t,n]=(0,o.useState)(!1),{data:a}=(0,c.ZP)("/api/users",r.Z,{dedupingInterval:2e3}),{data:i}=(0,c.ZP)(a?`/api/workspaces/${e}/channels`:null,r.Z),p=(0,o.useCallback)((()=>{n((e=>!e))}),[]);return o.createElement(o.Fragment,null,o.createElement("h2",null,o.createElement(l,{collapse:t,onClick:p},o.createElement("i",{className:"c-icon p-channel_sidebar__section_heading_expand p-channel_sidebar__section_heading_expand--show_more_feature c-icon--caret-right c-icon--inherit c-icon--inline","data-qa":"channel-section-collapse","aria-hidden":"true"})),o.createElement("span",null,"Channels")),o.createElement("div",null,!t&&(null==i?void 0:i.map((e=>o.createElement(d,{key:e.id,channel:e}))))))},m=(0,a.Z)("div",{target:"eotctb41"})({name:"10w7pu7",styles:"position:fixed;text-align:center;left:0;bottom:0;top:0;right:0;z-index:1022;&>div{margin-top:200px;display:inline-block;width:440px;background:white;--saf-0:rgba(var(--sk_foreground_low, 29, 28, 29), 0.13);box-shadow:0 0 0 1px var(--saf-0),0 4px 12px 0 rgba(0, 0, 0, 0.12);background-color:rgba(var(--sk_foreground_min_solid, 248, 248, 248), 1);border-radius:6px;user-select:none;max-width:440px;padding:30px 40px 0;z-index:1012;position:relative;}"}),u=(0,a.Z)("button",{target:"eotctb40"})({name:"19gmbxq",styles:"position:absolute;right:10px;top:6px;background:transparent;border:none;font-size:30px;cursor:pointer"}),h=({show:e,children:t,onCloseModal:n})=>{const a=(0,o.useCallback)((e=>{e.stopPropagation()}),[]);return e?o.createElement(m,{onClick:n},o.createElement("div",{onClick:a},o.createElement(u,{onClick:n},"×"),t)):null};var g=n(8678),b=n(3046),f=n(9669),x=n.n(f),v=n(9249);const k=({show:e,onCloseModal:t,setShowCreateChannelModal:n})=>{const a=(0,s.UO)(),{workspace:l}=a,[i,d,p]=(0,g.Z)(""),{data:m}=(0,c.ZP)("/api/users",r.Z),{revalidate:u}=(0,c.ZP)(m?`/api/workspaces/${l}/channels`:null,r.Z),f=(0,o.useCallback)((e=>{e.preventDefault(),i&&i.trim()&&x().post(`/api/workspaces/${l}/channels`,{name:i}).then((()=>{u(),n(!1),p("")})).catch((e=>{var t;console.dir(e),v.Am.error(null===(t=e.response)||void 0===t?void 0:t.data,{position:"bottom-center"})}))}),[i]);return o.createElement(h,{show:e,onCloseModal:t},o.createElement("form",{onSubmit:f},o.createElement(b.__,{id:"channel-label"},o.createElement("span",null,"채널 이름"),o.createElement(b.II,{id:"channel",value:i,onChange:d})),o.createElement(b.zx,null,"생성하기")))},w=({member:e,isOnline:t})=>{const{workspace:n}=(0,s.UO)(),a=(0,s.TH)(),{data:l}=(0,c.ZP)("/api/users",r.Z,{dedupingInterval:2e3}),d=localStorage.getItem(`${n}-${e.id}`)||0,{data:p,mutate:m}=(0,c.ZP)(l?`/api/workspaces/${n}/dms/${e.id}/unreads?after=${d}`:null,r.Z);return(0,o.useEffect)((()=>{a.pathname===`/workspace/${n}/dm/${e.id}`&&m(0)}),[m,a.pathname,n,e]),o.createElement(i.OL,{key:e.id,activeClassName:"selected",to:`/workspace/${n}/dm/${e.id}`},o.createElement("i",{className:"c-icon p-channel_sidebar__presence_icon p-channel_sidebar__presence_icon--dim_enabled c-presence "+(t?"c-presence--active c-icon--presence-online":"c-icon--presence-offline"),"aria-hidden":"true","data-qa":"presence_indicator","data-qa-presence-self":"false","data-qa-presence-active":"false","data-qa-presence-dnd":"false"}),o.createElement("span",{className:p&&p>0?"bold":void 0},e.nickname),e.id===(null==l?void 0:l.id)&&o.createElement("span",null," (나)"),p&&p>0&&o.createElement("span",{className:"count"},p)||null)};var E=n(6809),y=n.n(E);const C={},_=e=>{const t=(0,o.useCallback)((()=>{e&&C[e]&&(C[e].disconnect(),delete C[e])}),[e]);return e?(C[e]||(C[e]=y().connect(`http://localhost:3095/ws-${e}`,{transports:["websocket"]}),console.info("create socket",e,C[e])),[C[e],t]):[void 0,t]},Z=()=>{const{workspace:e}=(0,s.UO)(),{data:t}=(0,c.ZP)("/api/users",r.Z,{dedupingInterval:2e3}),{data:n}=(0,c.ZP)(t?`/api/workspaces/${e}/members`:null,r.Z),[a]=_(e),[i,d]=(0,o.useState)(!1),[p,m]=(0,o.useState)([]),u=(0,o.useCallback)((()=>{d((e=>!e))}),[]);return(0,o.useEffect)((()=>{console.log("DMList: workspace 바꼈다",e),m([])}),[e]),(0,o.useEffect)((()=>(null==a||a.on("onlineList",(e=>{m(e)})),console.log("socket on dm",null==a?void 0:a.hasListeners("dm"),a),()=>{console.log("socket off dm",null==a?void 0:a.hasListeners("dm")),null==a||a.off("onlineList")})),[a]),o.createElement(o.Fragment,null,o.createElement("h2",null,o.createElement(l,{collapse:i,onClick:u},o.createElement("i",{className:"c-icon p-channel_sidebar__section_heading_expand p-channel_sidebar__section_heading_expand--show_more_feature c-icon--caret-right c-icon--inherit c-icon--inline","data-qa":"channel-section-collapse","aria-hidden":"true"})),o.createElement("span",null,"Direct Messages")),o.createElement("div",null,!i&&(null==n?void 0:n.map((e=>{const t=p.includes(e.id);return o.createElement(w,{key:e.id,member:e,isOnline:t})})))))},$=({show:e,onCloseModal:t,setShowInviteWorkspaceModal:n})=>{const{workspace:a}=(0,s.UO)(),[l,i,d]=(0,g.Z)(""),{data:p}=(0,c.ZP)("/api/users",r.Z),{revalidate:m}=(0,c.ZP)(p?`/api/workspaces/${a}/members`:null,r.Z),u=(0,o.useCallback)((e=>{e.preventDefault(),l&&l.trim()&&x().post(`/api/workspaces/${a}/members`,{email:l}).then((()=>{m(),n(!1),d("")})).catch((e=>{var t;console.dir(e),v.Am.error(null===(t=e.response)||void 0===t?void 0:t.data,{position:"bottom-center"})}))}),[a,l]);return o.createElement(h,{show:e,onCloseModal:t},o.createElement("form",{onSubmit:u},o.createElement(b.__,{id:"member-label"},o.createElement("span",null,"이메일"),o.createElement(b.II,{id:"member",type:"email",value:l,onChange:i})),o.createElement(b.zx,{type:"submit"},"초대하기")))};let S="";const z=({show:e,onCloseModal:t,setShowKickWorkspaceModal:n})=>{const{workspace:a}=(0,s.UO)(),{data:l}=(0,c.ZP)("/api/users",r.Z,{dedupingInterval:2e3}),{data:i}=(0,c.ZP)(l?`/api/workspaces/${a}/members`:null,r.Z),{revalidate:d}=(0,c.ZP)(l?`/api/workspaces/${a}/members`:null,r.Z),p=(0,o.useCallback)((e=>{e.preventDefault(),S&&S.trim()&&"0"!==S?x().delete(`/api/workspaces/${a}/members/${S}`).then((()=>{n(!1),S="",d()})).catch((e=>{console.dir(e),n(!1),S="",v.Am.error("사용자 삭제에 실패했습니다.",{position:"bottom-center"})})):v.Am.error("사용자를 선택하세요.",{position:"bottom-center"})}),[a]);return o.createElement(h,{show:e,onCloseModal:t},o.createElement("form",{onSubmit:p},o.createElement(b.__,{id:"member-label"},o.createElement("span",null,"사용자 이름"),o.createElement(b.Ph,{id:"memberId",onChange:e=>{S=e.target.value,console.log(e.target.value)}},o.createElement("option",{key:"0",value:0},"선택하세요"),";",null==i?void 0:i.map((e=>{if((null==l?void 0:l.id)!==e.id)return o.createElement("option",{key:e.id,value:e.id},e.nickname)}))),o.createElement("br",null),o.createElement("br",null)),o.createElement(b.zx,{type:"submit"},"사용자 삭제")))},T=(0,a.Z)("div",{target:"epfh1t1"})({name:"3nqusf",styles:"position:fixed;top:0;right:0;left:0;bottom:0;z-index:1000;&>div{position:absolute;display:inline-block;--saf-0:rgba(var(--sk_foreground_low, 29, 28, 29), 0.13);box-shadow:0 0 0 1px var(--saf-0),0 4px 12px 0 rgba(0, 0, 0, 0.12);background-color:rgba(var(--sk_foreground_min_solid, 248, 248, 248), 1);border-radius:6px;user-select:none;min-width:360px;z-index:512;max-height:calc(100vh - 20px);color:rgb(29, 28, 29);}"}),I=(0,a.Z)("button",{target:"epfh1t0"})({name:"19gmbxq",styles:"position:absolute;right:10px;top:6px;background:transparent;border:none;font-size:30px;cursor:pointer"}),M=({closeButton:e,style:t,show:n,children:a,onCloseModal:l})=>{const r=(0,o.useCallback)((e=>{e.stopPropagation()}),[]);return n?o.createElement(T,{onClick:l},o.createElement("div",{onClick:r,style:t},e&&o.createElement(I,{onClick:l},"×"),a)):null};M.defaultProps={closeButton:!0};const P=M;var D=n(1039);const A=(0,a.Z)("div",{target:"e7828515"})({name:"ra6cyy",styles:"display:flex;width:100%;padding:20px;padding-top:0"}),O=(0,a.Z)("form",{target:"e7828514"})({name:"33ihw2",styles:"color:rgb(29, 28, 29);font-size:15px;width:100%;border-radius:4px;border:1px solid rgb(29, 28, 29)"}),N=(0,a.Z)(D.r,{target:"e7828513"})({name:"1pim2y0",styles:"font-family:Slack-Lato,appleLogo,sans-serif;font-size:15px;padding:8px 9px;& strong{background:skyblue;}& textarea{height:44px;padding:9px 10px!important;outline:none!important;border-radius:4px!important;resize:none!important;line-height:22px;border:none;}& ul{border:1px solid lightgray;max-height:200px;overflow-y:auto;padding:9px 10px;background:white;border-radius:4px;width:150px;}"}),U=(0,a.Z)("div",{target:"e7828512"})({name:"13ie2qx",styles:"position:relative;background:rgb(248, 248, 248);height:41px;display:flex;border-top:1px solid rgb(221, 221, 221);align-items:center;border-bottom-left-radius:4px;border-bottom-right-radius:4px"}),q=(0,a.Z)("button",{target:"e7828511"})({name:"xrrdm2",styles:"position:absolute;right:5px;top:5px"}),B=(0,a.Z)("button",{target:"e7828510"})("padding:4px 20px;background:transparent;border:none;display:flex;align-items:center;color:rgb(28, 29, 28);width:100%;& img{margin-right:5px;}",(({focus:e})=>e&&"\n    background: #1264a3;\n    color: white;\n  "),";");var j=n(9367),R=n.n(j),W=n(6182),F=n.n(W);const H=({onSubmitForm:e,chat:t,onChangeChat:n,placeholder:a,data:l})=>{const r=(0,o.useRef)(null);(0,o.useEffect)((()=>{r.current&&R()(r.current)}),[r.current]);const s=(0,o.useCallback)((t=>{"Enter"===t.key&&(t.shiftKey||(t.preventDefault(),e(t)))}),[t]),i=(0,o.useCallback)(((e,t,n,a,r)=>l?o.createElement(B,{focus:r},o.createElement("img",{src:F().url(l[a].email,{s:"20px",d:"retro"}),alt:l[a].nickname}),o.createElement("span",null,n)):null),[l]);return o.createElement(A,null,o.createElement(O,{onSubmit:e},o.createElement(N,{id:"editor-chat",value:t,onChange:n,onKeyPress:s,placeholder:a,inputRef:r,allowSuggestionsAboveCursor:!0},o.createElement(D.p,{appendSpaceOnAdd:!0,trigger:"@",data:(null==l?void 0:l.map((e=>({id:e.id,display:e.nickname}))))||[],renderSuggestion:i})),o.createElement(U,null,o.createElement(q,{className:"c-button-unstyled c-icon_button c-icon_button--light c-icon_button--size_medium c-texty_input__button c-texty_input__button--send"+(null!=t&&t.trim()?"":" c-texty_input__button--disabled"),"data-qa":"texty_send_button","aria-label":"Send message","data-sk":"tooltip_parent",type:"submit",disabled:!(null!=t&&t.trim())},o.createElement("i",{className:"c-icon c-icon--paperplane-filled","aria-hidden":"true"})))))},L=(0,a.Z)("div",{target:"e13jx3bw0"})({name:"2yhi1c",styles:"display:flex;padding:8px 20px;&:hover{background:#eee;}& .chat-img{display:flex;width:36px;margin-right:8px;& img{width:36px;height:36px;}}& .chat-text{display:flex;flex-wrap:wrap;flex:1;& p{flex:0 0 100%;margin:0;}}& .chat-user{display:flex;flex:0 0 100%;align-items:center;&>b{margin-right:5px;}&>span{font-size:12px;}}& a{text-decoration:none;color:deepskyblue;}"});var K=n(7484),V=n.n(K),Y=n(8817);const G=(0,o.memo)((({data:e})=>{const{workspace:t}=(0,s.UO)(),n="Sender"in e?e.Sender:e.User,a=(0,o.useMemo)((()=>e.content.startsWith("uploads\\")?o.createElement("img",{src:`http://localhost:3095/${e.content}`,style:{maxHeight:200}}):(0,Y.Z)({pattern:/@\[(.+?)]\((\d+?)\)|\n/g,decorator(e,n){const a=e.match(/@\[(.+?)]\((\d+?)\)/);return a?o.createElement(i.rU,{key:e+n,to:`/workspace/${t}/dm/${a[2]}`},"@",a[1]):o.createElement("br",{key:n})},input:e.content})),[t,e.content]);return o.createElement(L,null,o.createElement("div",{className:"chat-img"},o.createElement("img",{src:F().url(n.email,{s:"36px",d:"retro"}),alt:n.nickname})),o.createElement("div",{className:"chat-text"},o.createElement("div",{className:"chat-user"},o.createElement("b",null,n.nickname),o.createElement("span",null,V()(e.createdAt).format("h:mm A"))),o.createElement("p",null,a)))})),J=(0,a.Z)("div",{target:"emdi30u2"})({name:"1op36e9",styles:"width:100%;display:flex;flex:1"}),Q=(0,a.Z)("section",{target:"emdi30u1"})({name:"10zp55f",styles:"margin-top:20px;border-top:1px solid #eee"}),X=(0,a.Z)("div",{target:"emdi30u0"})({name:"16cu5ak",styles:"display:flex;justify-content:center;flex:1;width:100%;position:sticky;top:14px;& button{font-weight:bold;font-size:13px;height:28px;line-height:27px;padding:0 16px;z-index:2;--saf-0:rgba(var(--sk_foreground_low, 29, 28, 29), 0.13);box-shadow:0 0 0 1px var(--saf-0),0 1px 3px 0 rgba(0, 0, 0, 0.08);border-radius:24px;position:relative;top:-13px;background:white;border:none;outline:none;}"});var ee=n(1298);const te=({scrollbarRef:e,isReachingEnd:t,isEmpty:n,chatSections:a,setSize:l})=>{const r=(0,o.useCallback)((a=>{0!==a.scrollTop||t||n||l((e=>e+1)).then((()=>{var t,n;null===(t=e.current)||void 0===t||t.scrollTop((null===(n=e.current)||void 0===n?void 0:n.getScrollHeight())-a.scrollHeight)}))}),[l,e,t,n]);return o.createElement(J,null,o.createElement(ee.$B,{autoHide:!0,ref:e,onScrollFrame:r},Object.entries(a).map((([e,t])=>o.createElement(Q,{className:`section-${e}`,key:e},o.createElement(X,null,o.createElement("button",null,e)),t.map((e=>o.createElement(G,{key:e.id,data:e}))))))))},ne=({show:e,onCloseModal:t,setShowInviteChannelModal:n})=>{const{workspace:a,channel:l}=(0,s.UO)(),[i,d,p]=(0,g.Z)(""),{data:m}=(0,c.ZP)("/api/users",r.Z),{revalidate:u}=(0,c.ZP)(m?`/api/workspaces/${a}/channels/${l}/members`:null,r.Z),f=(0,o.useCallback)((e=>{e.preventDefault(),i&&i.trim()&&x().post(`/api/workspaces/${a}/channels/${l}/members`,{email:i}).then((()=>{u(),n(!1),p("")})).catch((e=>{var t;console.dir(e),v.Am.error(null===(t=e.response)||void 0===t?void 0:t.data,{position:"bottom-center"})}))}),[i]);return o.createElement(h,{show:e,onCloseModal:t},o.createElement("form",{onSubmit:f},o.createElement(b.__,{id:"member-label"},o.createElement("span",null,"채널 멤버 초대"),o.createElement(b.II,{id:"member",value:i,onChange:d})),o.createElement(b.zx,{type:"submit"},"초대하기")))},ae=(0,a.Z)("div",{target:"e1ud5d6k2"})({name:"1a0r0eh",styles:"display:flex;flex-wrap:wrap;height:calc(100vh - 38px);flex-flow:column;position:relative"}),le=(0,a.Z)("header",{target:"e1ud5d6k1"})({name:"1thq1gs",styles:"height:64px;display:flex;width:100%;--saf-0:rgba(var(--sk_foreground_low, 29, 28, 29), 0.13);box-shadow:0 1px 0 var(--saf-0);padding:20px 16px 20px 20px;font-weight:bold;align-items:center"}),re=(0,a.Z)("div",{target:"e1ud5d6k0"})({name:"czjct4",styles:"position:absolute;top:64px;left:0;width:100%;height:calc(100% - 64px);background:white;opacity:0.7;display:flex;align-items:center;justify-content:center;font-size:40px"});function oe(e){const t={};return e.forEach((e=>{const n=V()(e.createdAt).format("YYYY-MM-DD");Array.isArray(t[n])?t[n].push(e):t[n]=[e]})),t}const se=()=>{var e,t;const{workspace:n,channel:a}=(0,s.UO)(),[l]=_(n),{data:i}=(0,c.ZP)("/api/users",r.Z),{data:d}=(0,c.ZP)(`/api/workspaces/${n}/channels`,r.Z),p=null==d?void 0:d.find((e=>e.name===a)),{data:m,mutate:u,setSize:h}=(0,c.g_)((e=>`/api/workspaces/${n}/channels/${a}/chats?perPage=20&page=${e+1}`),r.Z,{onSuccess(e){1===(null==e?void 0:e.length)&&setTimeout((()=>{var e;null===(e=C.current)||void 0===e||e.scrollToBottom()}),100)}}),{data:b}=(0,c.ZP)(i?`/api/workspaces/${n}/channels/${a}/members`:null,r.Z),[f,k,w]=(0,g.Z)(""),[E,y]=(0,o.useState)(!1),C=(0,o.useRef)(null),[Z,$]=(0,o.useState)(!1),S=0===(null==m||null===(e=m[0])||void 0===e?void 0:e.length),z=S||m&&(null===(t=m[m.length-1])||void 0===t?void 0:t.length)<20,T=(0,o.useCallback)((()=>{y(!1)}),[]),I=(0,o.useCallback)((e=>{if(e.preventDefault(),null!=f&&f.trim()&&m&&p&&i){const e=f;u((t=>{var n;return null==t||t[0].unshift({id:((null===(n=m[0][0])||void 0===n?void 0:n.id)||0)+1,content:e,UserId:i.id,User:i,createdAt:new Date,ChannelId:p.id,Channel:p}),t}),!1).then((()=>{var e;localStorage.setItem(`${n}-${a}`,(new Date).getTime().toString()),w(""),C.current&&(console.log("scrollToBottom!",null===(e=C.current)||void 0===e?void 0:e.getValues()),C.current.scrollToBottom())})),x().post(`/api/workspaces/${n}/channels/${a}/chats`,{content:e}).catch(console.error)}}),[f,n,a,p,i,m]),M=(0,o.useCallback)((e=>{e.Channel.name!==a||!e.content.startsWith("uploads\\")&&e.UserId===(null==i?void 0:i.id)||u((t=>(null==t||t[0].unshift(e),t)),!1).then((()=>{var e;C.current&&(C.current.getScrollHeight()<C.current.getClientHeight()+C.current.getScrollTop()+150?(console.log("scrollToBottom!",null===(e=C.current)||void 0===e?void 0:e.getValues()),setTimeout((()=>{var e;null===(e=C.current)||void 0===e||e.scrollToBottom()}),100)):v.Am.success("새 메시지가 도착했습니다.",{onClick(){var e;null===(e=C.current)||void 0===e||e.scrollToBottom()},closeOnClick:!0}))}))}),[a,i,u]);(0,o.useEffect)((()=>(null==l||l.on("message",M),()=>{null==l||l.off("message",M)})),[l,M]),(0,o.useEffect)((()=>{localStorage.setItem(`${n}-${a}`,(new Date).getTime().toString())}),[n,a]);const P=(0,o.useCallback)((()=>{y(!0)}),[]),D=(0,o.useCallback)((e=>{e.preventDefault(),console.log(e);const t=new FormData;if(e.dataTransfer.items){for(let n=0;n<e.dataTransfer.items.length;n++)if("file"===e.dataTransfer.items[n].kind){const a=e.dataTransfer.items[n].getAsFile();console.log("... file["+n+"].name = "+a.name),t.append("image",a)}}else for(let n=0;n<e.dataTransfer.files.length;n++)console.log("... file["+n+"].name = "+e.dataTransfer.files[n].name),t.append("image",e.dataTransfer.files[n]);x().post(`/api/workspaces/${n}/channels/${a}/images`,t).then((()=>{$(!1),localStorage.setItem(`${n}-${a}`,(new Date).getTime().toString())}))}),[n,a]),A=(0,o.useCallback)((e=>{e.preventDefault(),console.log(e),$(!0)}),[]);if(d&&!p)return o.createElement(s.l_,{to:`/workspace/${n}/channel/일반`});const O=oe(m?[].concat(...m).reverse():[]);return o.createElement(ae,{onDrop:D,onDragOver:A},o.createElement(le,null,o.createElement("span",null,"#",a),o.createElement("div",{style:{display:"flex",flex:1,justifyContent:"flex-end",alignItems:"center"}},o.createElement("span",null,null==b?void 0:b.length),o.createElement("button",{onClick:P,className:"c-button-unstyled p-ia__view_header__button","aria-label":"Add people to #react-native","data-sk":"tooltip_parent",type:"button"},o.createElement("i",{className:"c-icon p-ia__view_header__button_icon c-icon--add-user","aria-hidden":"true"})))),o.createElement(te,{scrollbarRef:C,isReachingEnd:z,isEmpty:S,chatSections:O,setSize:h}),o.createElement(H,{onSubmitForm:I,chat:f,onChangeChat:k,placeholder:`Message #${a}`,data:b}),o.createElement(ne,{show:E,onCloseModal:T,setShowInviteChannelModal:y}),o.createElement(v.Ix,{position:"bottom-center"}),Z&&o.createElement(re,null,"업로드!"))},ie=(0,a.Z)("div",{target:"e15abt741"})({name:"1a0r0eh",styles:"display:flex;flex-wrap:wrap;height:calc(100vh - 38px);flex-flow:column;position:relative"}),ce=(0,a.Z)("header",{target:"e15abt740"})({name:"1c17pcy",styles:"height:64px;display:flex;width:100%;--saf-0:rgba(var(--sk_foreground_low, 29, 28, 29), 0.13);box-shadow:0 1px 0 var(--saf-0);padding:20px 16px 20px 20px;font-weight:bold;align-items:center;& img{margin-right:5px;}"}),de=()=>{var e,t;const{workspace:n,id:a}=(0,s.UO)(),[l]=_(n),{data:i}=(0,c.ZP)("/api/users",r.Z),{data:d}=(0,c.ZP)(`/api/workspaces/${n}/users/${a}`,r.Z),{data:p,mutate:m,setSize:u,revalidate:h}=(0,c.g_)((e=>`/api/workspaces/${n}/dms/${a}/chats?perPage=20&page=${e+1}`),r.Z,{onSuccess(e){1===(null==e?void 0:e.length)&&setTimeout((()=>{var e;null===(e=w.current)||void 0===e||e.scrollToBottom()}),100)}}),[b,f,k]=(0,g.Z)(""),w=(0,o.useRef)(null),[E,y]=(0,o.useState)(!1),C=0===(null==p||null===(e=p[0])||void 0===e?void 0:e.length),Z=C||p&&(null===(t=p[p.length-1])||void 0===t?void 0:t.length)<20,$=(0,o.useCallback)((e=>{if(e.preventDefault(),null!=b&&b.trim()&&p){const e=b;m((t=>{var n;return null==t||t[0].unshift({id:((null===(n=p[0][0])||void 0===n?void 0:n.id)||0)+1,content:e,SenderId:i.id,Sender:i,ReceiverId:d.id,Receiver:d,createdAt:new Date}),t}),!1).then((()=>{var e;localStorage.setItem(`${n}-${a}`,(new Date).getTime().toString()),k(""),w.current&&(console.log("scrollToBottom!",null===(e=w.current)||void 0===e?void 0:e.getValues()),w.current.scrollToBottom())})),x().post(`/api/workspaces/${n}/dms/${a}/chats`,{content:b}).catch(console.error)}}),[b,n,a,i,d,p]),S=(0,o.useCallback)((e=>{e.SenderId===Number(a)&&i.id!==Number(a)&&m((t=>(null==t||t[0].unshift(e),t)),!1).then((()=>{var e;w.current&&(w.current.getScrollHeight()<w.current.getClientHeight()+w.current.getScrollTop()+150?(console.log("scrollToBottom!",null===(e=w.current)||void 0===e?void 0:e.getValues()),setTimeout((()=>{var e;null===(e=w.current)||void 0===e||e.scrollToBottom()}),100)):v.Am.success("새 메시지가 도착했습니다.",{onClick(){var e;null===(e=w.current)||void 0===e||e.scrollToBottom()},closeOnClick:!0}))}))}),[a,i,m]);(0,o.useEffect)((()=>(null==l||l.on("dm",S),()=>{null==l||l.off("dm",S)})),[l,S]),(0,o.useEffect)((()=>{localStorage.setItem(`${n}-${a}`,(new Date).getTime().toString())}),[n,a]);const z=(0,o.useCallback)((e=>{e.preventDefault(),console.log(e);const t=new FormData;if(e.dataTransfer.items){for(let n=0;n<e.dataTransfer.items.length;n++)if("file"===e.dataTransfer.items[n].kind){const a=e.dataTransfer.items[n].getAsFile();console.log("... file["+n+"].name = "+a.name),t.append("image",a)}}else for(let n=0;n<e.dataTransfer.files.length;n++)console.log("... file["+n+"].name = "+e.dataTransfer.files[n].name),t.append("image",e.dataTransfer.files[n]);x().post(`/api/workspaces/${n}/dms/${a}/images`,t).then((()=>{y(!1),localStorage.setItem(`${n}-${a}`,(new Date).getTime().toString()),h()}))}),[n,a]),T=(0,o.useCallback)((e=>{e.preventDefault(),console.log(e),y(!0)}),[]);if(!d||!i)return null;const I=oe(p?[].concat(...p).reverse():[]);return o.createElement(ie,{onDrop:z,onDragOver:T},o.createElement(ce,null,o.createElement("img",{src:F().url(d.email,{s:"24px",d:"retro"}),alt:d.nickname}),o.createElement("span",null,d.nickname)),o.createElement(te,{scrollbarRef:w,isReachingEnd:Z,isEmpty:C,chatSections:I,setSize:u}),o.createElement(H,{onSubmitForm:$,chat:b,onChangeChat:f,placeholder:`Message ${d.nickname}`,data:[]}),E&&o.createElement(re,null,"업로드!"))};n(5202);const pe=(0,a.Z)("div",{target:"e1uh5zr713"})({name:"tjo4qw",styles:"float:right"}),me=(0,a.Z)("header",{target:"e1uh5zr712"})({name:"fvf0bi",styles:"height:38px;background:#350d36;color:#ffffff;box-shadow:0 1px 0 0 rgba(255, 255, 255, 0.1);padding:5px;text-align:center"}),ue=(0,a.Z)("img",{target:"e1uh5zr711"})({name:"1ly4jlu",styles:"width:28px;height:28px;position:absolute;top:5px;right:16px"}),he=(0,a.Z)("div",{target:"e1uh5zr710"})({name:"47px7v",styles:"display:flex;padding:20px;& img{display:flex;}&>div{display:flex;flex-direction:column;margin-left:10px;}& #profile-name{font-weight:bold;display:inline-flex;}& #profile-active{font-size:13px;display:inline-flex;}"}),ge=(0,a.Z)("button",{target:"e1uh5zr79"})({name:"bl1q1k",styles:"border:none;width:100%;border-top:1px solid rgb(29, 28, 29);background:transparent;display:block;height:33px;padding:5px 20px 5px;outline:none;cursor:pointer"}),be=(0,a.Z)("div",{target:"e1uh5zr78"})({name:"36bnqj",styles:"display:flex;flex:1"}),fe=(0,a.Z)("div",{target:"e1uh5zr77"})({name:"17lvj7e",styles:"width:65px;display:inline-flex;flex-direction:column;align-items:center;background:#3f0e40;border-top:1px solid rgb(82, 38, 83);border-right:1px solid rgb(82, 38, 83);vertical-align:top;text-align:center;padding:15px 0 0"}),xe=(0,a.Z)("nav",{target:"e1uh5zr76"})({name:"2pkygn",styles:"width:260px;display:inline-flex;flex-direction:column;background:#3f0e40;color:rgb(188, 171, 188);vertical-align:top;& a{padding-left:36px;color:inherit;text-decoration:none;height:28px;line-height:28px;display:flex;align-items:center;&.selected{color:white;}}& .bold{color:white;font-weight:bold;}& .count{margin-left:auto;background:#cd2553;border-radius:16px;display:inline-block;font-size:12px;font-weight:700;height:18px;line-height:18px;padding:0 9px;color:white;margin-right:16px;}& h2{height:36px;line-height:36px;margin:0;text-overflow:ellipsis;overflow:hidden;white-space:nowrap;font-size:15px;}"}),ve=(0,a.Z)("button",{target:"e1uh5zr75"})({name:"1rmthq7",styles:"height:64px;line-height:64px;border:none;width:100%;text-align:left;border-top:1px solid rgb(82, 38, 83);border-bottom:1px solid rgb(82, 38, 83);font-weight:900;font-size:24px;background:transparent;text-overflow:ellipsis;overflow:hidden;white-space:nowrap;padding:0;padding-left:16px;margin:0;color:white;cursor:pointer"}),ke=(0,a.Z)("div",{target:"e1uh5zr74"})({name:"1146j5j",styles:"height:calc(100vh - 102px);overflow-y:auto"}),we=(0,a.Z)("div",{target:"e1uh5zr73"})({name:"192o1ir",styles:"padding:10px 0 0;& h2{padding-left:20px;}&>button{width:100%;height:28px;padding:4px;border:none;background:transparent;border-top:1px solid rgb(28, 29, 28);cursor:pointer;&:last-of-type{border-bottom:1px solid rgb(28, 29, 28);}}"}),Ee=(0,a.Z)("div",{target:"e1uh5zr72"})({name:"82a6rk",styles:"flex:1"}),ye=(0,a.Z)("button",{target:"e1uh5zr71"})({name:"9tlmej",styles:"color:white;font-size:24px;display:inline-block;width:40px;height:40px;background:transparent;border:none;cursor:pointer"}),Ce=(0,a.Z)("button",{target:"e1uh5zr70"})({name:"wsqixl",styles:"display:inline-block;width:40px;height:40px;border-radius:10px;background:white;border:3px solid #3f0e40;margin-bottom:15px;font-size:18px;font-weight:700;color:black;cursor:pointer"}),_e=()=>{var e,t;const n=(0,s.UO)(),{workspace:a}=n,[l,d]=_(a),{data:m,error:u,revalidate:f}=(0,c.ZP)("/api/users",r.Z),{data:w}=(0,c.ZP)(m?`/api/workspaces/${a}/channels`:null,r.Z),[E,y]=(0,o.useState)(!1),[C,S]=(0,o.useState)(!1),[T,I]=(0,o.useState)(!1),[M,D]=(0,o.useState)(!1),[A,O]=(0,o.useState)(!1),[N,U]=(0,o.useState)(!1),[q,B,j]=(0,g.Z)(""),[R,W,H]=(0,g.Z)(""),L=(0,o.useCallback)((()=>{x().post("/api/users/logout").then((()=>{f()})).catch((e=>{var t;console.dir(e),v.Am.error(null===(t=e.response)||void 0===t?void 0:t.data,{position:"bottom-center"})}))}),[]),K=(0,o.useCallback)((e=>{e.preventDefault(),q&&q.trim()&&R&&R.trim()&&x().post("/api/workspaces",{workspace:q,url:R}).then((()=>{f(),y(!1),j(""),H("")})).catch((e=>{var t;console.dir(e),v.Am.error(null===(t=e.response)||void 0===t?void 0:t.data,{position:"bottom-center"})}))}),[q,R]),V=(0,o.useCallback)((()=>{y(!0)}),[]),Y=(0,o.useCallback)((()=>{I(!0)}),[]),G=(0,o.useCallback)((()=>{S(!0)}),[]),J=(0,o.useCallback)((()=>{D(!0)}),[]),Q=(0,o.useCallback)((()=>{y(!1),I(!1),S(!1),D(!1)}),[]),X=(0,o.useCallback)((()=>{O((e=>!e))}),[]),ee=(0,o.useCallback)((()=>{U((e=>!e))}),[]);return(0,o.useEffect)((()=>()=>{console.info("disconnect socket",a),d()}),[d,a]),(0,o.useEffect)((()=>{w&&m&&(console.info("로그인하자",l),null==l||l.emit("login",{id:null==m?void 0:m.id,channels:w.map((e=>e.id))}))}),[l,m,w]),!1===m?o.createElement(s.l_,{to:"/login"}):o.createElement("div",null,o.createElement(me,null,m&&o.createElement(pe,null,o.createElement("span",{onClick:X},o.createElement(ue,{src:F().url(m.email,{s:"28px",d:"retro"}),alt:m.nickname})),A&&o.createElement(P,{style:{right:0,top:38},show:A,onCloseModal:X},o.createElement(he,null,o.createElement("img",{src:F().url(m.email,{s:"36px",d:"retro"}),alt:m.nickname}),o.createElement("div",null,o.createElement("span",{id:"profile-name"},m.nickname),o.createElement("span",{id:"profile-active"},"Active"))),o.createElement(ge,{onClick:L},"로그아웃")))),o.createElement(be,null,o.createElement(fe,null,null==m?void 0:m.Workspaces.map((e=>o.createElement(i.rU,{key:e.id,to:`/workspace/${e.url}/channel/일반`},o.createElement(Ce,null,e.name.slice(0,1).toUpperCase())))),o.createElement(ye,{onClick:V},"+")),o.createElement(xe,null,o.createElement(ve,{onClick:ee},null==m||null===(e=m.Workspaces.find((e=>e.url===a)))||void 0===e?void 0:e.name),o.createElement(ke,null,o.createElement(P,{show:N,onCloseModal:ee,style:{top:95,left:80}},o.createElement(we,null,o.createElement("h2",null,null==m||null===(t=m.Workspaces.find((e=>e.url===a)))||void 0===t?void 0:t.name),o.createElement("button",{onClick:G},"워크스페이스에 사용자 초대"),o.createElement("button",{onClick:Y},"채널 만들기"),o.createElement("button",{onClick:J},"사용자 삭제"),o.createElement("button",{onClick:L},"로그아웃"))),o.createElement(p,null),o.createElement(Z,null))),o.createElement(Ee,null,o.createElement(s.rs,null,o.createElement(s.AW,{path:"/workspace/:workspace/channel/:channel",component:se}),o.createElement(s.AW,{path:"/workspace/:workspace/dm/:id",component:de})))),o.createElement(h,{show:E,onCloseModal:Q},o.createElement("form",{onSubmit:K},o.createElement(b.__,{id:"workspace-label"},o.createElement("span",null,"워크스페이스 이름"),o.createElement(b.II,{id:"workspace",value:q,onChange:B})),o.createElement(b.__,{id:"workspace-url-label"},o.createElement("span",null,"워크스페이스 url"),o.createElement(b.II,{id:"workspace-url",value:R,onChange:W})),o.createElement(b.zx,{type:"submit"},"생성하기"))),o.createElement(k,{show:T,onCloseModal:Q,setShowCreateChannelModal:I}),o.createElement($,{show:C,onCloseModal:Q,setShowInviteWorkspaceModal:S}),o.createElement(z,{show:M,onCloseModal:Q,setShowKickWorkspaceModal:D}),o.createElement(v.Ix,{position:"bottom-center"}))}},7020:()=>{}}]);