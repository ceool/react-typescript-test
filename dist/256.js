(self.webpackChunkslack_react_ts=self.webpackChunkslack_react_ts||[]).push([[256],{5256:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>w});var l=a(2309),n=a(2545),o=a(9250),s=a(8678),r=a(2951),c=a(7753);const i=(0,c.Z)("div",{target:"e1ud5d6k2"})({name:"1a0r0eh",styles:"display:flex;flex-wrap:wrap;height:calc(100vh - 38px);flex-flow:column;position:relative"}),d=(0,c.Z)("header",{target:"e1ud5d6k1"})({name:"1ezwwi6",styles:"height:64px;display:flex;width:100%;--saf-0:rgba(var(--sk_foreground_low, 29, 28, 29), 0.13);box-shadow:0 1px 0 var(--saf-0);padding:20px 16px 20px 20px;font-weight:bold;align-items:center;& .header-right{display:flex;flex:1;justify-content:flex-end;align-items:center;}"}),u=(0,c.Z)("div",{target:"e1ud5d6k0"})({name:"czjct4",styles:"position:absolute;top:64px;left:0;width:100%;height:calc(100% - 64px);background:white;opacity:0.7;display:flex;align-items:center;justify-content:center;font-size:40px"});var h=a(3564),p=a(8667),f=a(9669),g=a.n(f),m=a(7294),v=a(5977),k=a(8118);const w=()=>{var e,t;const{workspace:a,channel:c}=(0,v.UO)(),{data:f}=(0,k.ZP)("/api/users",h.Z),[w,b,x]=(0,s.Z)(""),{data:_}=(0,k.ZP)(`/api/workspaces/${a}/channels/${c}`,h.Z),{data:C,mutate:Z,revalidate:E,setSize:T}=(0,k.g_)((e=>`/api/workspaces/${a}/channels/${c}/chats?perPage=20&page=${e+1}`),h.Z),{data:y}=(0,k.ZP)(f?`/api/workspaces/${a}/channels/${c}/members`:null,h.Z),[$]=(0,r.Z)(a),S=0===(null==C||null===(e=C[0])||void 0===e?void 0:e.length)||C&&(null===(t=C[C.length-1])||void 0===t?void 0:t.length)<20||!1,D=(0,m.useRef)(null),[z,B]=(0,m.useState)(!1),[I,P]=(0,m.useState)(!1),U=(0,m.useCallback)((e=>{if(e.preventDefault(),console.log(w),null!=w&&w.trim()&&C&&_){const e=w;Z((t=>{var a;return null==t||t[0].unshift({id:((null===(a=C[0][0])||void 0===a?void 0:a.id)||0)+1,content:e,UserId:f.id,User:f,ChannelId:_.id,Channel:_,createdAt:new Date}),t}),!1).then((()=>{var e;x(""),null===(e=D.current)||void 0===e||e.scrollToBottom()})),g().post(`/api/workspaces/${a}/channels/${c}/chats`,{content:w}).then((()=>{E()})).catch(console.error)}}),[w,C,f,_,a,c]),j=(0,m.useCallback)((e=>{e.Channel.name===c&&e.UserId!==(null==f?void 0:f.id)&&Z((t=>(null==t||t[0].unshift(e),t)),!1).then((()=>{var e;D.current&&D.current.getScrollHeight()<D.current.getClientHeight()+D.current.getScrollTop()+150&&(console.log("scrollToBottom!",null===(e=D.current)||void 0===e?void 0:e.getValues()),setTimeout((()=>{var e;null===(e=D.current)||void 0===e||e.scrollToBottom()}),50))}))}),[c,f]);(0,m.useEffect)((()=>(null==$||$.on("message",j),()=>{null==$||$.off("message",j)})),[$,j]),(0,m.useEffect)((()=>{1===(null==C?void 0:C.length)&&(console.log("toBottomWhenLoaded",D.current),setTimeout((()=>{var e;console.log("scrollbar",D.current),null===(e=D.current)||void 0===e||e.scrollToBottom()}),500))}),[C]);const A=(0,m.useCallback)((()=>{B(!0)}),[]),F=(0,m.useCallback)((()=>{B(!1)}),[]),N=(0,m.useCallback)((e=>{e.preventDefault(),console.log(e);const t=new FormData;if(e.dataTransfer.items){for(let a=0;a<e.dataTransfer.items.length;a++)if("file"===e.dataTransfer.items[a].kind){const l=e.dataTransfer.items[a].getAsFile();console.log("... file["+a+"].name = "+l.name),t.append("image",l)}}else for(let a=0;a<e.dataTransfer.files.length;a++)console.log("... file["+a+"].name = "+e.dataTransfer.files[a].name),t.append("image",e.dataTransfer.files[a]);g().post(`/api/workspaces/${a}/channels/${c}/images`,t).then((()=>{P(!1)}))}),[a,c]),H=(0,m.useCallback)((e=>{e.preventDefault(),console.log(e),P(!0)}),[]);if(!f)return null;const M=(0,p.Z)(C?C.flat().reverse():[]);return m.createElement(i,{onDrop:N,onDragOver:H},m.createElement(d,null,m.createElement("span",null,"#",c),m.createElement("div",{className:"header-right"},m.createElement("span",null,null==y?void 0:y.length),m.createElement("button",{onClick:A,className:"c-button-unstyled p-ia__view_header__button","aria-label":"Add people to #react-native","data-sk":"tooltip_parent",type:"button"},m.createElement("i",{className:"c-icon p-ia__view_header__button_icon c-icon--add-user","aria-hidden":"true"})))),m.createElement(n.Z,{chatSections:M,ref:D,setSize:T,isReachingEnd:S}),m.createElement(l.Z,{chat:w,onChangeChat:b,onSubmitForm:U}),m.createElement(o.Z,{show:z,onCloseModal:F,setShowInviteChannelModal:B}),I&&m.createElement(u,null,"업로드!"))}}}]);