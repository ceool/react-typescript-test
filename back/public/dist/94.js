(self.webpackChunkslack_react_ts=self.webpackChunkslack_react_ts||[]).push([[94],{3094:(e,t,l)=>{"use strict";l.r(t),l.d(t,{default:()=>k});var n=l(7753);const a=(0,n.Z)("div",{target:"e15abt742"})({name:"1a0r0eh",styles:"display:flex;flex-wrap:wrap;height:calc(100vh - 38px);flex-flow:column;position:relative"}),r=(0,n.Z)("header",{target:"e15abt741"})({name:"1c17pcy",styles:"height:64px;display:flex;width:100%;--saf-0:rgba(var(--sk_foreground_low, 29, 28, 29), 0.13);box-shadow:0 1px 0 var(--saf-0);padding:20px 16px 20px 20px;font-weight:bold;align-items:center;& img{margin-right:5px;}"});(0,n.Z)("div",{target:"e15abt740"})({name:"czjct4",styles:"position:absolute;top:64px;left:0;width:100%;height:calc(100% - 64px);background:white;opacity:0.7;display:flex;align-items:center;justify-content:center;font-size:40px"});var o=l(3564),s=l(9669),c=l.n(s),i=l(7294),u=l(6182),d=l.n(u),p=l(5977),h=l(8118),g=l(8678),m=l(2545),v=l(2309),f=l(8667),x=l(2951);const k=()=>{var e,t;const{workspace:l,id:n}=(0,p.UO)(),{data:s}=(0,h.ZP)(`/api/workspaces/${l}/users/${n}`,o.Z),{data:u}=(0,h.ZP)("/api/users",o.Z),[k,w,b]=(0,g.Z)(""),{data:Z,mutate:S,revalidate:y,setSize:E}=(0,h.g_)((e=>`/api/workspaces/${l}/dms/${n}/chats?perPage=20&page=${e+1}`),o.Z),[C]=(0,x.Z)(l),T=0===(null==Z||null===(e=Z[0])||void 0===e?void 0:e.length)||Z&&(null===(t=Z[Z.length-1])||void 0===t?void 0:t.length)<20||!1,$=(0,i.useRef)(null),[_,z]=(0,i.useState)(!1),B=(0,i.useCallback)((e=>{e.SenderId===Number(n)&&u.id!==Number(n)&&S((t=>(null==t||t[0].unshift(e),t)),!1).then((()=>{var e;$.current&&$.current.getScrollHeight()<$.current.getClientHeight()+$.current.getScrollTop()+150&&(console.log("scrollToBottom!",null===(e=$.current)||void 0===e?void 0:e.getValues()),setTimeout((()=>{var e;null===(e=$.current)||void 0===e||e.scrollToBottom()}),50))}))}),[]);(0,i.useEffect)((()=>(null==C||C.on("dm",B),()=>{null==C||C.off("dm",B)})),[C,B]),(0,i.useEffect)((()=>{1===(null==Z?void 0:Z.length)&&setTimeout((()=>{var e;null===(e=$.current)||void 0===e||e.scrollToBottom()}),100)}),[Z]);const R=(0,i.useCallback)((e=>{if(e.preventDefault(),console.log(k),null!=k&&k.trim()&&Z){const e=k;S((t=>{var l;return null==t||t[0].unshift({id:((null===(l=Z[0][0])||void 0===l?void 0:l.id)||0)+1,content:e,SenderId:u.id,Sender:u,ReceiverId:s.id,Receiver:s,createdAt:new Date}),t}),!1).then((()=>{var e;b(""),null===(e=$.current)||void 0===e||e.scrollToBottom()})),c().post(`/api/workspaces/${l}/dms/${n}/chats`,{content:k}).then((()=>{y()})).catch(console.error)}}),[k,Z,u,s,l,n]);if(!s||!u)return null;const I=(0,f.Z)(Z?Z.flat().reverse():[]);return i.createElement(a,null,i.createElement(r,null,i.createElement("img",{src:d().url(s.email,{s:"24px",d:"retro"}),alt:s.nickname}),i.createElement("span",null,s.nickname)),i.createElement(m.Z,{chatSections:I,ref:$,setSize:E,isReachingEnd:T}),i.createElement(v.Z,{chat:k,onChangeChat:w,onSubmitForm:R}))}}}]);